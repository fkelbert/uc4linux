#!/bin/sh

# Check select syscall decoding.

. "${srcdir=.}/init.sh"

check_prog awk

./select ||
	framework_skip_ 'select syscall does not behave as expected'

syscall=
for n in select _newselect; do
	if $STRACE -e$n -h > /dev/null; then
		syscall=$n
		break
	fi
done
[ -n "$syscall" ] ||
	fail_ "$STRACE does not support select syscall?"

args="-e$syscall ./select"
$STRACE -o "$LOG" $args || {
	cat "$LOG"
	fail_ "$STRACE $args failed"
}

awk -f "$srcdir"/select.awk "$LOG" || {
	cat "$LOG"
	fail_ 'unexpected output'
}

exit 0
