<?xml version="1.0"?>

<enforcementAssertion 
  xmlns="http://www.iese.fhg.de/esf/1.0/enforcementLanguage"
  xmlns:tns="http://www.iese.fhg.de/esf/1.0/enforcementLanguage"
  xmlns:a="http://www.iese.fhg.de/esf/1.0/action" 
  xmlns:e="http://www.iese.fhg.de/esf/1.0/event"
  xmlns:mc="http://www.master-fp7.eu/mcalculus.xsd"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="
    http://www.iese.fhg.de/esf/1.0/enforcementLanguage enforcementLanguage-FhG.xsd
    http://www.iese.fhg.de/esf/1.0/action action-FhG.xsd
    http://www.iese.fhg.de/esf/1.0/event event-FhG.xsd
    http://www.master-fp7.eu/mcalculus.xsd mcalculus.xsd">

  <preventiveMechanism name="BlockTimeout">
    <description>Block timeout alarm when an ACK was received</description>
    <timestep amount="1" unit="MINUTES"/>
    <trigger action="message">
      <e:paramMatch name="operation" value="timeout"/>
    </trigger>
    <condition>
      <not>
        <always>
          <not>
            <eventMatch action="message">
              <e:paramMatch name="operation" value="ACK"/>
            </eventMatch>
          </not>
        </always>
      </not>
    </condition>
    <authorizationAction>
      <inhibit/>
    </authorizationAction>
  </preventiveMechanism>


  <preventiveMechanism name="BlockAfterAlarm">
    <description>
      Blocks all Messages from Agency and invokes Penalization service
    </description>
    <timestep amount="1" unit="MINUTES"/>
    <trigger action="message">
      <e:paramMatch name="source" value="Agency"/>
    </trigger>
    <condition>
      <not>
        <always>
          <not>
            <eventMatch action="message">
              <e:paramMatch name="operation" value="timeout" />
            </eventMatch>
          </not>
        </always>
      </not>
    </condition>
    <authorizationAction>
      <inhibit />
    </authorizationAction>
    <action name="penalize">
      <a:parameter name="par1" value="blockAgency" />
    </action>
  </preventiveMechanism>

</enforcementAssertion>