<?xml version="1.0" encoding="UTF-8"?>
<policySet 
  xmlns="http://www.iese.fhg.de/esf/1.0/enforcementLanguage"
  xmlns:tns="http://www.iese.fhg.de/esf/1.0/enforcementLanguage"
  xmlns:a="http://www.iese.fhg.de/esf/1.0/action" 
  xmlns:e="http://www.iese.fhg.de/esf/1.0/event"
  xmlns:mc="http://www.master-fp7.eu/mcalculus.xsd"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="
    http://www.iese.fhg.de/esf/1.0/enforcementLanguage enforcementLanguage-FhG.xsd
    http://www.iese.fhg.de/esf/1.0/action action-FhG.xsd
    http://www.iese.fhg.de/esf/1.0/event event-FhG.xsd
    http://www.master-fp7.eu/mcalculus.xsd mcalculus.xsd">

  <actionDescriptions>
  
    <!-- all system calls inherit a common set of parameters -->
    <a:actionDescription name="syscall">
      <a:parameterDescription name="processId"/>
      <a:parameterDescription name="command"/>
      <a:parameterDescription name="username">
        <a:value>neisse</a:value>
        <a:value>moucha</a:value>
      </a:parameterDescription>
    </a:actionDescription>
    
    <a:actionDescription name="open" subclassOf="syscall">
      <a:parameterDescription name="path"/>
    </a:actionDescription>

    <a:actionDescription name="read" class="USAGE" subclassOf="syscall"/>
    <a:actionDescription name="write" subclassOf="syscall"/>
    <a:actionDescription name="unlink" subclassOf="syscall"/>

    <a:actionDescription name="login" class="SIGNALING">
      <a:parameterDescription name="result"/>
    </a:actionDescription>

    <a:actionDescription name="logout"/>

    <a:actionDescription name="log">
      <a:parameterDescription name="msg"/>
    </a:actionDescription>

    <a:actionDescription name="QueryDebtorRequest">
      <a:parameterDescription name="alreadyRequested"/>
    </a:actionDescription>
    
    <a:actionDescription name="Ack"/>
    
    <a:actionDescription name="Alarm"/>
    
  </actionDescriptions>
   
  <preventiveMechanism name="Preventive1">
    <description>Test of preventive mechanism1</description>
    <timestep amount="1" unit="SECONDS"/>
    <trigger action="open" index="ALL" isTry="true">
      <e:paramMatch name="path" value="/etc/passwd"/>
    </trigger>
    <!-- A complete condition that does not make
         any sense, but uses all operators. -->
  <condition>
    <not>
      <implies>
        <or>
          <or>
            <true/>
            <false/>
          </or>
          <or>
            <or>
              <always>
                <eventMatch action="login"/>
              </always>
              <before amount="3">
                <eventMatch action="login"/>
              </before>
            </or>
            <or>
              <since>
                <eventMatch action="login"/>
                <eventMatch action="logout"/>
              </since>
              <or>
                <during amount="3">
                  <eventMatch action="login"/>
                </during>
                <within amount="4">
                  <eventMatch action="logout"/>
                </within>
              </or>
            </or>
          </or>
        </or>
        <or>
          <xPathEval>//trigger/param[name='path']/@value = 'etc/passwd'</xPathEval>
          <or>
            <and>
              <repSince limit="1">
                <eventMatch action="open"/>
                <eventMatch action="unlink"/>
              </repSince>
              <repMax limit="2">
                <eventMatch action="unlink"/>
              </repMax>
            </and>
            <repLim amount="6" lowerLimit="3" upperLimit="5">
              <eventMatch action="read"/>
            </repLim>
          </or>
        </or>
      </implies>
    </not>
  </condition>
    <authorizationAction>
      <allow>
        <delay amount="1" unit="SECONDS"/>
        <modify>
          <parameter name="path" value="dev/null"/>
        </modify>
      </allow>
    </authorizationAction>
    <action name="log">
      <a:parameter name="msg" value="Access to password file redirected to /dev/null."/>
    </action>
  </preventiveMechanism>

  <!--<preventiveMechanism name="Preventive2">
    <description>Test of preventive mechanism2</description>
    <timestep amount="1" unit="SECONDS"/>
    <trigger action="open">
      <e:paramMatch name="path" value="/etc/shadow"/>
    </trigger>
    <condition>
      <true/>
    </condition>
    <authorizationAction>
      <inhibit>
        <delay amount="2" unit="SECONDS"/>
      </inhibit>
    </authorizationAction>
    <action name="log">
      <a:parameter name="msg" value="Access to password file redirected to /dev/null."/>
    </action>
  </preventiveMechanism>-->

</policySet>
