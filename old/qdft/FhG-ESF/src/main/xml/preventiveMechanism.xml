<?xml version="1.0" encoding="UTF-8"?>
<preventiveMechanism name="Preventive1"
  xmlns="http://www.iese.fhg.de/esf/1.0/enforcementLanguage"
  xmlns:b="http://www.iese.fhg.de/esf/1.0/base"
  xmlns:a="http://www.iese.fhg.de/esf/1.0/action" 
  xmlns:e="http://www.iese.fhg.de/esf/1.0/event"
  xmlns:mc="http://www.master-fp7.eu/mcalculus.xsd"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="
    http://www.iese.fhg.de/esf/1.0/time time-FhG.xsd
    http://www.iese.fhg.de/esf/1.0/action action-FhG.xsd
    http://www.iese.fhg.de/esf/1.0/event event-FhG.xsd
    http://www.iese.fhg.de/esf/1.0/enforcementLanguage enforcementLanguage-FhG.xsd
    http://www.master-fp7.eu/mcalculus.xsd mcalculus.xsd">

  <description>Test of preventive mechanism</description>

  <timestep amount="1" unit="SECONDS"/>

  <trigger action="open">
    <e:paramMatch name="path" value="/etc/passwd"/>
  </trigger>

  <condition>
    <not>
      <implies>
        <or>
          <or>
            <true/>
            <false/>
          </or>
          <or>
            <or>
              <always>
                <eventMatch action="success"/>
              </always>
              <before amount="3">
                <eventMatch action="fail"/>
              </before>
            </or>
            <or>
              <since>
                <eventMatch action="success"/>
                <eventMatch action="fail"/>
              </since>
              <or>
                <during amount="3">
                  <eventMatch action="success"/>
                </during>
                <within amount="4">
                  <eventMatch action="success"/>
                </within>
              </or>
            </or>
          </or>
        </or>
        <or>
          <xPathEval>//trigger/param[name='path']/@value = 'etc/passwd'</xPathEval>
          <or>
            <and>
              <repSince limit="1">
                <eventMatch action="open"/>
                <eventMatch action="close"/>
              </repSince>
              <repMax limit="2">
                <eventMatch action="unlink"/>
              </repMax>
            </and>
            <repLim lowerLimit="3" upperLimit="5">
              <eventMatch action="read"/>
            </repLim>
          </or>
        </or>
      </implies>
    </not>
  </condition>

  <authorizationAction>
    <allow>
      <delay amount="1" unit="SECONDS" />
      <modify>
        <parameter name="path" value="dev/null" />
      </modify>
    </allow>
  </authorizationAction>
  
  <action name="log">
    <a:parameter name="msg" value="Access to password file redirected to /dev/null."/>
  </action>

</preventiveMechanism>
