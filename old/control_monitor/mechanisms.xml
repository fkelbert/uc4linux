<?xml version="1.0"?>

<monitorConfiguration
	xmlns="http://www.master-fp7.eu/Master-EnfLang-FHG"
	xmlns:event="http://www.master-fp7.eu/event"
	xmlns:propositionalLogic="http://www.master-fp7.eu/propositionalLogic"
	xmlns:pastOSL="http://www.master-fp7.eu/pastOSL"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.master-fp7.eu event.xsd
						http://www.master-fp7.eu propositionalLogic.xsd
						http://www.master-fp7.eu pastOSL.xsd
						http://www.master-fp7.eu Master-EnfLang-FHG.xsd">

<controlMechanism>
  <id>BlockingOfMessages</id>
  <description>
    If event1 has ever happened in the past
    block messages where source contains 'www.foo.com'
    and destination contains 'www.bar.it'
  </description>
  <triggerEvent xmlns="http://www.master-fp7.eu/event">
    <id>message</id>
    <parameter name="source" value="www.foo.com"/>
    <parameter name="destination" value="www.bar.it"/>
  </triggerEvent>
  <condition xmlns="http://www.master-fp7.eu/pastOSL">
    <not>
      <always>
        <not>
  	      <event xmlns="http://www.master-fp7.eu/event">
	        <id>event1</id>
	      </event>
        </not>
      </always>
    </not>
  </condition>
  <actions>
    <inhibit/>
  </actions>  
</controlMechanism>

<controlMechanism>
  <id>AnonymizeMessages</id>
  <description>
    If event2 is received, anonymize messages where
    destination does not contain 'hsr.it' and
    contains 'patient_name' in the payload
  </description>
  <triggerEvent xmlns="http://www.master-fp7.eu/event">
    <id>message</id>
  </triggerEvent>
  <condition xmlns="http://www.master-fp7.eu/pastOSL">
    <and>
      <and>
        <XPathEval>/triggerEvent/parameter[@name='destination']/@value!='www.hsr.it'</XPathEval>
        <XPathEval>/triggerEvent/parameter[@name='patient_name']/@value!=''</XPathEval>
      </and>
      <not><always><not>
	  <event xmlns="http://www.master-fp7.eu/event">
	    <id>event2</id>
	  </event>
	  </not></always></not>
    </and>
  </condition>
  <actions>
    <allow>
      <modify>
        <parameter name="patient_name" value="ANONYMOUS"/>
      </modify>
    </allow>
  </actions>  
</controlMechanism>

</monitorConfiguration>